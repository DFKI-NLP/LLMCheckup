<!-- This code is modified from a script provided in https://studygyaan.com/python/create-web-based-chatbot-in-python-django-flask -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LLMCheckup</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/static/styles/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
        .mui-switch {
            width: 52px;
            height: 31px;
            position: relative;
            border: 1px solid #dfdfdf;
            background-color: #fdfdfd;
            box-shadow: #dfdfdf 0 0 0 0 inset;
            border-radius: 20px;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            background-clip: content-box;
            display: inline-block;
            -webkit-appearance: none;
            user-select: none;
            outline: none;
        }

        .mui-switch:before {
            content: '';
            width: 29px;
            height: 29px;
            position: absolute;
            top: 0px;
            left: 0;
            border-radius: 20px;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        .mui-switch:checked {
            border-color: #64bd63;
            box-shadow: #64bd63 0 0 0 16px inset;
            background-color: #64bd63;
        }

        .mui-switch:checked:before {
            left: 21px;
        }

        .mui-switch.mui-switch-animbg {
            transition: background-color ease 0.4s;
        }

        .mui-switch.mui-switch-animbg:before {
            transition: left 0.3s;
        }

        .mui-switch.mui-switch-animbg:checked {
            box-shadow: #dfdfdf 0 0 0 0 inset;
            background-color: #64bd63;
            transition: border-color 0.4s, background-color ease 0.4s;
        }

        .mui-switch.mui-switch-animbg:checked:before {
            transition: left 0.3s;
        }

        .mui-switch.mui-switch-anim {
            transition: border cubic-bezier(0, 0, 0, 1) 0.4s, box-shadow cubic-bezier(0, 0, 0, 1) 0.4s;
        }

        .mui-switch.mui-switch-anim:before {
            transition: left 0.3s;
        }

        .mui-switch.mui-switch-anim:checked {
            box-shadow: #64bd63 0 0 0 16px inset;
            background-color: #64bd63;
            transition: border ease 0.4s, box-shadow ease 0.4s, background-color ease 1.2s;
        }

        .mui-switch.mui-switch-anim:checked:before {
            transition: left 0.3s;
        }
    </style>
</head>

<body>

<messagebody>
    <!-- The text interaction part of the method -->
    <section class="ttm">
        <header class="ttm-header">
            <div class="ttm-header-title">
                <img src="{{url_for('static', filename='images/logo.png')}}"
                     style="width: 150px; height: 150px; align: center; margin: 5px">
            </div>
            <div class="container">
                <div class="row">
                    <div id="accordion" class="col-4">
                        <button style="float: left; width: 200px;
                    height: 50px; font-size: 20px; background-color: #fed3ff; border: solid #fed3ff" class="openciv">
                            Custom Input Viewer
                        </button>
                    </div>
                    <div class="col-4">

                    </div>

                    <div class="col-4">
                        <button style="float: right; font-size: 20px;" class="opendv">Dataset Viewer</button>
                    </div>
                </div>
            </div>
        </header>
        <main class="ttm-chat">
            <div class="msg left-msg">
                <div class="msg-bubble">
                    <div class="msg-text">
                        Hello üòä, I'm a machine learning model trained to {{ datasetObjective }}.
                        <br><br>
                        Let's get started. Ask me something!
                    </div>
                </div>
            </div>

            <div class="slideSideways">
                <!-- Filter dataset by string ("includes") -->
                <b>üîç Filter dataset by text:</b>
                <form class="filterdata-inputarea">
                    <input type="text" class="filterdata-input" id="filterdataInput" placeholder="Filter dataset">
                </form>
                <h1 style="font: small-caps bold 20px/1 sans-serif; margin-top: 10px">üóÉÔ∏è {{dataset}} dataset
                    viewer </h1>
                <div id="show_data"
                     style="border-radius: 15px; padding: 5px; overflow-y: scroll; height: 70%;">
                    {% for entry in entries %}
                    {% if dataset == 'ECQA' %}
                    <details>
                        <summary style="font-weight: bold;">ID: {{loop.index-1}}</summary>
                        <b>Question:</b> <br>
                        <div style='font-style: italic; font-size: 0.75em;'>{{entry["texts"]}}</div>
                        <b>Choices:</b> <br>
                        <div style='font-style: italic; font-size: 0.75em;'>{{entry["choices"]}}</div>
                        <button onclick="addId({{loop.index-1}})">Add this instance into input box</button>
                    </details>
                    {% else %}
                    <details>
                        <summary style="font-weight: bold;">ID: {{loop.index-1}}</summary>
                        <b>Claim:</b> <br>
                        <div style='font-style: italic; font-size: 0.75em;'>{{entry["claims"]}}</div>
                        <b>Evidence:</b> <br>
                        <div style='font-style: italic; font-size: 0.75em;'>{{entry["evidences"]}}</div>
                        <button onclick="addId({{loop.index-1}})">Add this instance into input box</button>
                    </details>
                    {% endif %}
                    <br>
                    {% endfor %}
                    <br>(Showing first 10)
                </div>
            </div>

            <div class="slideSideways_ci" style="background-color: #bdbdbd; display: none">
                <b>Custom Input history</b>
                <div id="custom_input_history">

                </div>

            </div>
        </main>

        <form class="ttm-inputarea">
            <div style="text-align:center;">
                <input type="file" id="fileupload-btn" name="file-upload" accept=".jpg,.jpeg,.png" hidden>
                <label for="fileupload-btn" style="background-color: aquamarine;
              color: black;
              display:inline-block;
              /*float: left;*/
              padding: 10px;
              /*margin-right: 10px;*/
              font-family: sans-serif;
              border-radius: 0.3rem;
              cursor: pointer;
              font-size: small;
              margin-top: 1rem;">Choose File</label>

                <button id="record-btn" style="background-color: bisque; display: inline-block">Record Audio</button>
            </div>


            <input onkeyup="checkSubmit(event)" rows="1" cols="50" type="text" class="ttm-input"
                   id="textInput"
                   placeholder="Enter your command! Use the ‚Üë arrow and ‚Üì arrow to cycle previous commands."></input>
            <button type="submit" class="ttm-send-btn" id="ttm-send-btn-id">Send</button>
        </form>
        <span class="genOptions">üëáHelp me generate a question about...üëá</span>

        <div class="slideDown">
            <div id="infobox" style="visibility: hidden; color: red; font-style: italic"></div>
            <div class="dots-cont" id="generation-loading"><span class="dot dot-1"></span> <span
                    class="dot dot-2"></span> <span class="dot dot-3"></span></div>
            <div id="knobs"
                 style="display: table; padding: 10px; width: 100%; margin-top: -10px; margin-left: 15px; margin-right: 15px;">
                <div class="rowc" id="custom_input_btns" style="display: none">
                    <div class="control" style="display: table-cell; text-align: right; padding: 10px;"><b>Custom
                        input</b></div>
                    <div class="tooltip-wrapper">
                        <button id="c_pred" class="idea-button" style="background: rgba(253, 186, 54, 0.96);"
                                onclick="sampleCustomInputPrediction()">
                            Single prediction
                        </button>
                        <span class="tooltip-text">
                            Lets the model predict a <b>custom input</b> provided by you.
                        </span>
                    </div>
                    <div class="tooltip-wrapper">
                        <button id="c_data" class="idea-button" style="background: rgba(235, 244, 61, 0.96);"
                                onclick="sampleCustomInputDataAugmentation()">
                            Data Augmentation
                        </button>
                        <span class="tooltip-text">
                            Generates a <b>modified</b> version of a given <b>custom input</b> that can be used as a <b>new data point</b>.
                        </span>
                    </div>
                    <div class="tooltip-wrapper">
                        <button id="c_cfe" class="idea-button"
                                style="background: rgba(235, 244, 61, 0.96);"
                                onclick="sampleCustomInputCounterfactual()">
                            Counterfactual
                        </button>
                        <span class="tooltip-text">
                            Generates a <b>modified</b> version of a given <b>custom input</b> that <b>flips</b> the model's <b>prediction</b> from one label to another.
                        </span>
                    </div>
                    <div class="tooltip-wrapper">
                        <button id="c_rat" class="idea-button"
                                style="background: rgba(235, 244, 61, 0.96);"
                                onclick="sampleCustomInputRationalization()">
                            Rationalization
                        </button>
                        <span class="tooltip-text">
                            Generates a <b>free-text justification</b> for the model's prediction on a <b>custom input</b>.
                        </span>
                    </div>

                    <div class="tooltip-wrapper">
                        <button id="c_fa" class="idea-button"
                                style="background: rgba(235, 244, 61, 0.96);"
                                onclick="sampleCustomInputFeatureAttribution()">
                            Feature Attribution
                        </button>
                        <span class="tooltip-text">
                            Indicates which <b>tokens</b> for a <b>custom input</b> are <b>most important</b>. Also prints a heatmap visualization.
                        </span>
                    </div>

                    <div class="tooltip-wrapper">
                        <button id="c_sim" class="idea-button"
                                style="background: rgba(235, 215, 57, 0.96);"
                                onclick="sampleCustomInputSimilarity()">
                            Similarity
                        </button>
                        <span class="tooltip-text">
                            Retrieves a number of <b>examples</b> from the dataset that are semantically <b>similar</b> to a given <b>custom input</b>.
                        </span>
                    </div>
                </div>
                <div class="row row1" data-sort="abt_" style="display: table-row;">
                    <div class="control" style="display: table-cell; text-align: right; padding: 10px;"><b>About</b>
                    </div>
                    <div class="buttons" style="display: table-cell;">
                        <div class="tooltip-wrapper">
                            <button id="abt_self" class="idea-button" onclick="sampleAboutSelf()">
                                LLMCheckup
                            </button>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="abt_function" class="idea-button" onclick="sampleAboutFunction()">
                                System capabilities
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row row1" data-sort="qa" style="display: table-row;">
                    <div class="control" style="display: table-cell; text-align: right; padding: 10px;"><b>Tutorial</b>
                    </div>
                    <div class="buttons" style="display: table-cell;">
                        <div class="tooltip-wrapper">
                            <button id="qa_cfe" class="idea-button" onclick="sampleQAcfe()">
                                Counterfactual
                            </button>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="qa_da" class="idea-button" onclick="sampleQAaug()">
                                Augmentation
                            </button>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="qa_fa" class="idea-button" onclick="sampleQAFA()">
                                Feature Importance
                            </button>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="qa_rationale" class="idea-button" onclick="sampleQARationale()">
                                Rationale
                            </button>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="qa_sim" class="idea-button" onclick="sampleQASim()">
                                Similarity
                            </button>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="qa_ci" class="idea-button" onclick="sampleQACI()">
                                Custom Input
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row row2" data-sort="md_" style="display: table-row;">
                    <div class="control" style="display: table-cell; text-align: right; padding: 10px;"><b>Metadata</b>
                    </div>
                    <div class="buttons" style="display: table-cell;">
                        <div class="tooltip-wrapper">
                            <button id="md_show" class="idea-button" onclick="sampleShow()">
                                Show example
                            </button>
                            <span class="tooltip-text">
                                Displays a <b>single example</b> from the dataset based on the <b>ID</b> you specify.
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="md_train-data-description" class="idea-button"
                                    onclick="sampleModel()">
                                Model
                            </button>
                            <span class="tooltip-text">
                                Get meta information about the model.
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="md_test-data-description" class="idea-button"
                                    onclick="sampleDataSummary()">
                                Data summary
                            </button>
                            <span class="tooltip-text">
                                Describe the summary of data.
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="md_count-data" class="idea-button" onclick="sampleCountData()">
                                Count data
                            </button>
                            <span class="tooltip-text">
                                Shows <b>how many</b> examples there are in the data and what the range of <b>IDs</b> is.
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="md_labels" class="idea-button" onclick="sampleLabels()">
                                True labels
                            </button>
                            <span class="tooltip-text">
                                Shows the <b>distribution</b> of the <b>true labels</b>, i.e. how the examples were annotated by humans.
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row row3" data-sort="pred_" style="display: table-row;">
                    <div class="control" style="display: table-cell; text-align: right; padding: 10px;">
                        <b>Prediction</b></div>
                    <div class="buttons" style="display: table-cell;">
                        <div class="tooltip-wrapper">
                            <button id="pred_predict" class="idea-button" onclick="samplePredict()">
                                Single prediction
                            </button>
                            <span class="tooltip-text">
                                Lets the model predict a <b>single instance</b> (ID).
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="pred_random" class="idea-button" onclick="sampleRandomPredict()">
                                Random prediction
                            </button>
                            <span class="tooltip-text">
                                Lets the model predict a <b>randomly selected instance</b> (ID).
                            </span>
                        </div> <!-- Move custom input prediction button here -->
                        <div class="tooltip-wrapper">
                            <button id="pred_score" class="idea-button" onclick="samplePerformance()">
                                Performance
                            </button>
                            <span class="tooltip-text">
                                Gets an overall <b>score</b> for the model performance (Accuracy, Precision, Recall, F1).
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="pred_mistakes-count" class="idea-button" onclick="sampleMistakeCount()">
                                Count mistakes
                            </button>
                            <span class="tooltip-text">
                                Shows <b>how many</b> examples the model predicts a <b>wrong label</b> for.
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="pred_mistakes-sample" class="idea-button" onclick="sampleMistakeSample()">
                                Sample mistakes
                            </button>
                            <span class="tooltip-text">
                                Shows <b>examples</b> where the model predicts a <b>wrong label</b>.
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row row4" data-sort="nlu_" style="display: table-row;">
                    <div class="control" style="display: table-cell; text-align: right; padding: 10px;">
                        <b>Understanding</b></div>
                    <div class="buttons" style="display: table-cell;">
                        <div class="tooltip-wrapper">
                            <button id="nlu_similar" class="idea-button" onclick="sampleSimilar()">
                                Similar examples
                            </button>
                            <span class="tooltip-text">
                                Retrieves a number of <b>examples</b> from the dataset that are semantically <b>similar</b> to a given <b>single example</b> (ID).
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="nlu_keyword" class="idea-button" onclick="sampleKeyword()">
                                Most frequent keywords
                            </button>
                            <span class="tooltip-text">
                                Prints a table of the <b>most frequent keywords</b> in the data.
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row row5" data-sort="x_" style="display: table-row;">
                    <div class="control" style="display: table-cell; text-align: right; padding: 10px;">
                        <b>Explanation</b></div>
                    <div class="buttons" style="display: table-cell;">
                        <div class="tooltip-wrapper">
                            <button id="x_local" class="idea-button" onclick="sampleWhy()">
                                Local feature importance
                            </button>
                            <span class="tooltip-text">
                                Indicates which <b>tokens</b> for a <b>single example</b> (ID) are <b>most important</b>. Also prints a heatmap visualization.
                            </span>
                        </div>
                        <div class="tooltip-wrapper">
                            <button id="x_rationalize" class="idea-button" onclick="sampleRationalization()">
                                Rationalize
                            </button>
                            <span class="tooltip-text">
                                Generates a <b>free-text justification</b> for the model's prediction on a <b>single example</b> (ID).
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row row6" data-sort="ptb_" style="display: table-row;">
                    <div class="control" style="display: table-cell; text-align: right; padding: 10px;">
                        <b>Perturbation</b></div>
                    <div class="buttons" style="display: table-cell;">
                        <div class="tooltip-wrapper">
                            <button id="ptb_cfe" class="idea-button" onclick="sampleFlip()">
                                Counterfactual
                            </button>
                            <span class="tooltip-text">
                                Generates a <b>modified</b> version of a given <b>single example</b> (ID) that <b>flips</b> the model's <b>prediction</b> from one label to another.
                            </span>
                        </div>
                        {#
                        <div class="tooltip-wrapper">#}
                            {#
                            <button id="ptb_adversarial" class="idea-button" onclick="sampleAdversarial()">#}
                                {# Adversarial example#}
                                {#
                            </button>
                            #}
                            {# <span class="tooltip-text">#}
{#                                Generates a <b>modified</b> version of a given <b>single example</b> (ID) that <b>flips</b> the model's <b>prediction</b> from correct to <b>wrong</b>.#}
{#                            </span>#}
                            {#
                        </div>
                        #}
                        <div class="tooltip-wrapper">
                            <button id="ptb_augment" class="idea-button" onclick="sampleAugment()">
                                Augment
                            </button>
                            <span class="tooltip-text">
                                Generates a <b>modified</b> version of a given <b>single example</b> (ID) that can be used as a <b>new data point</b>.
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </main>

    </section>


    <section class="pins" id="my-pins">
        <header class="pins-header">
            <div class="pins-header-title">
                ‚öôÔ∏èSetting
            </div>
        </header>
        <main class="pins-scroll">
            <div class="single-select-checkbox">
                <div>
                    <img src="../static/images/book.png" width="40px" height="40px">
                    <h3 style="color: #9880ff; display: inline-block; vertical-align: middle;">Level of knowledge in
                        XAI</h3>
                </div>
                <input type="radio" id="option1" name="options" value="Option 1">
                <label for="option1" style="color: #579ffb">Beginner/Laypeople</label>
                <br>
                <input type="radio" id="option2" name="options" value="Option 2">
                <label for="option2" style="color: #579ffb">With expertise</label>
                <br>
                <input type="radio" id="option3" name="options" value="Option 3" checked>
                <label for="option3" style="color: #579ffb">Expert without need for assistance</label>
                <i style="font-size:24px; color: white" class="fa" id="icon0" title="Without tutorial">&#xf05a;</i>
            </div>

            <div style="margin-top: 50px">
                <div>
                    <img src="../static/images/typewriter.png" width="40px" height="40px"
                         style="vertical-align:middle;">
                    <h3 style="color: #9880ff; display: inline-block; vertical-align: middle; margin-left: 10px;">Custom
                        Input</h3>
                    <i style="font-size:24px; color: white" class="fa" id="icon1"
                       title="For ECQA, please enter options splitted by '-'">&#xf05a;</i>
                </div>

                <div>
                    <form>
                        {% if dataset == 'ECQA' %}
                        <label id="input_1"
                               style="display: inline-block; text-align: right; color: white; width: 100px">Question:</label>
                        <input type="text" id="first_text" placeholder="Your question..">
                        {% else %}
                        <label id="input_1"
                               style="display: inline-block; text-align: right; color: white; width: 100px">Claim:</label>
                        <input type="text" id="first_text" placeholder="Your claim..">
                        {% endif %}
                        <br>
                        {% if dataset == 'ECQA' %}
                        <label id="input_2"
                               style="display: inline-block; text-align: right; color: white; width: 100px">Choices:</label>
                        <input type="text" id="second_text" placeholder="Your chocies..">
                        {% else %}
                        <label id="input_2"
                               style="display: inline-block; text-align: right; color: white; width: 100px">Evidence:</label>
                        <input type="text" id="second_text" placeholder="Your evidence..">
                        {% endif %}
                        <br>
                        <button type="submit" class="ttm-send-btn" id="custom-input-send-btn-id" style="width: 100px"
                                onclick="submit_custom_input()">Send
                        </button>

                        <button type="submit" class="ttm-send-btn" id="custom-input-delete-btn-id"
                                onclick="delete_custom_input()" style="background-color: red; width: 100px">Delete
                        </button>
                    </form>

                </div>


                <div class="single-select-checkbox" style="margin-top: 50px">
                    <div>
                        <img src="../static/images/pen.png" width="40px" height="40px">
                        <h3 style="color: #9880ff; display: inline-block; vertical-align: middle;">Prompt
                            modification</h3>
                        <i style="font-size:24px; color: white" class="fa" id="icon2"
                           title="Enter/select prompt that will be appended in the original prompt (***for rationalization***)">&#xf05a;</i>
                    </div>

                    <div style="border-style: dashed; border-color: lightslategrey; padding: 10px; max-height: 200px; overflow-y: scroll">
                        <h5 style="color: lightseagreen">Current used system prompt:</h5>
                        <p id="prompt_holder">

                        </p>
                        <img src="../static/icons/loading-arrow.png" style="height: 40px; margin-bottom: 10px"
                             onclick="get_current_prompt()" type="button" data-toggle="tooltip" data-placement="right"
                             title="Refresh to get the current system prompt!">
                    </div>

                    <input type="radio" id="p_option1" name="_options" value="Option 4" checked>
                    <label for="p_option1" style="color: #579ffb">No additional prompt</label>
                    <i style="font-size:24px; color: white" class="fa" id="icon3"
                       title="The original designed prompt will be used">&#xf05a;</i>
                    <br>

                    <input type="radio" id="p_option2" name="_options" value="Option 5">
                    <label for="p_option2" style="color: #579ffb">Zero-shot CoT</label>
                    <i style="font-size:24px; color: white" class="fa" id="icon4"
                       title="Additional prompt: &quot;Let's think step by step&quot;" \>&#xf05a;</i>
                    <br>

                    <input type="radio" id="p_option3" name="_options" value="Option 6">
                    <label for="p_option3" style="color: #579ffb">Plan and Solve</label>
                    <i style="font-size:24px; color: white" class="fa" id="icon5"
                       title="Additional prompt: &quot;Let's first understand the problem and devise a plan to solve the problem. Then let's carry out the plan and solve the problem step by step&quot;">&#xf05a;</i>

                    <br>
                    <input type="radio" id="p_option4" name="_options" value="Option 7">
                    <label for="p_option4" style="color: #579ffb">Optimization by Prompting (OPRO)</label>
                    <i style="font-size:24px; color: white" class="fa" id="icon6"
                       title="Additional prompt: &quot;Take a deep breath and work on this problem step-by-step&quot;">&#xf05a;</i>

                    <br>
                    <input type="radio" id="p_option5" name="_options" value="Option 8">
                    <input id="custom_prompt_input" onfocus="document.getElementById('p_option5').checked=true"
                           for="p_option5" placeholder="additional prompt..."/>
                    <i style="font-size:24px; color: white" class="fa" id="icon7"
                       title="Additional prompt: &quot;Take a deep breath and work on this problem step-by-step&quot;">&#xf05a;</i>

                </div>

                <div style="margin-top: 50px">
                    <div>
                        <img src="../static/images/red-right-arrow.png" width="40px" height="40px"
                             style="vertical-align:middle;">
                        <h3 style="color: #9880ff; display: inline-block; vertical-align: middle; margin-left: 10px;">
                            Exporting history</h3>
                    </div>
                    <button type="button" class="btn btn-info" style="margin-top: 10px" onclick="export_history()">
                        Export
                    </button>
                </div>

                <div style="margin-top: 50px">
                    <div>
                        <img src="../static/images/bulb.png" width="40px" height="40px" style="vertical-align:middle;">
                        <h3 style="color: #9880ff; display: inline-block; vertical-align: middle; margin-left: 10px;">
                            Theme
                            changing</h3>
                    </div>
                    <label style="color: #64bd63; button: 5px" id="label4theme"><input
                            class="mui-switch mui-switch-animbg"
                            type="checkbox"
                            id="theme_changing"
                            onchange="change_theme(event)"></label>
                </div>

            </div>

        </main>
    </section>


</messagebody>
</body>
</html>

<script>
    function export_history() {
        event.preventDefault();

        $.ajax({
            url: "{{ url_for('.export_history') }}",
            type: 'POST',
            data: {},
            processData: false,
            contentType: false,
            success: function (data) {
                alert("The history is exported under cache folder as JSON file!")
            },
            error: function (error) {
                console.log('Error:', error);
            }
        });
    }

    function get_current_prompt() {
        event.preventDefault();

        $.ajax({
            url: "{{ url_for('.get_prompt') }}",
            type: 'POST',
            data: {},
            processData: false,
            contentType: false,
            success: function (data) {

                let temp = data;
                let returned_prompt = "<details><summary style='color: #64bd63'>";
                const split_arr = temp.split(" ");

                returned_prompt += split_arr[0]
                returned_prompt += "..."
                returned_prompt += "</summary>"
                returned_prompt += "<p style='color: #64bd63'>"
                returned_prompt += data;
                returned_prompt += "</p>"
                returned_prompt += "</details>"

                // document.getElementById("prompt_holder").insertAdjacentHTML("afterend", returned_prompt);
                document.getElementById("prompt_holder").innerHTML = returned_prompt;
            },
            error: function (error) {
                console.log('Error:', error);
            }
        });
    }

</script>

<script>
    let recorder;
    let audioChunks = [];

    function startRecording() {
        navigator.mediaDevices.getUserMedia({audio: true})
            .then(stream => {
                recorder = new MediaRecorder(stream);
                recorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };
                recorder.onstop = () => {
                    // ; codecs=vorbis
                    const blob = new Blob(audioChunks, {type: 'audio/wav'});
                    const formData = new FormData();
                    formData.append('audio', blob, "recording.wav");

                    event.preventDefault();
                    addToChat("right", "Asking for recording...", "");
                    insertLoadingDots();
                    ttmChat.scrollTop += 200;
                    ttmInput.value = "";

                    // Send the FormData object to the backend using AJAX
                    $.ajax({
                        url: "{{ url_for('.get_bot_response') }}",
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (data) {
                            console.log('Recorded successfully!');

                            const splitData = data.split('<>')
                            const msgText = splitData[0];
                            const logText = splitData[1];
                            console.log(data)
                            console.log(msgText)
                            deleteLoadingDots();
                            addToChat("left", msgText, logText);
                        },
                        error: function (error) {
                            console.log('Error while recording:', error);
                        }
                    });
                };
                recorder.start();
            })
            .catch(error => console.error('Error accessing microphone:', error));
    }

    var record_btn = document.getElementById('record-btn');
    record_btn.addEventListener('click', () => {
        if (recorder) {
            recorder.stop();
            console.log("stop");
            recorder = undefined;
        } else {
            startRecording();
            console.log(recorder);
            console.log("recording");
        }
    });

</script>

<script>
    $('.opendv').click(function (e) {
        var chatWidth = $('.ttm-chat').width();
        if ($('.slideSideways').is(':visible')) {
            $('.slideSideways').animate({left: chatWidth}, function () {
                $(this).hide();
            });
        } else {
            $('.slideSideways').show().animate({left: chatWidth / 2});
        }
    });

    $('.openciv').click(function (e) {
        var chatWidth = $('.ttm-chat').width();
        if ($('.slideSideways_ci').is(':visible')) {
            $('.slideSideways_ci').animate({left: chatWidth}, function () {
                $(this).hide();
            });
        } else {
            $('.slideSideways_ci').show().animate({left: chatWidth / 2});
        }
    });
</script>

<script>
    $('.genOptions').click(function (e) {
        $('.slideDown').slideToggle();
    });
</script>

<script>

    document.getElementById("fileupload-btn").addEventListener('change', function () {

        // Get the file input element
        var fileInput = document.getElementById('fileupload-btn');

        // Create a new FormData object
        var formData = new FormData();

        // Add the file to the FormData object
        formData.append('image', fileInput.files[0]);

        event.preventDefault();
        addToChat("right", "Asking for uploading images...", "");
        insertLoadingDots();
        ttmChat.scrollTop += 200;
        ttmInput.value = "";

        // Send the FormData object to the backend using AJAX
        $.ajax({
            url: "{{ url_for('.get_bot_response') }}",
            type: 'POST',
            body: formData,
            processData: false,
            contentType: false,
            success: function (data) {
                console.log('Image uploaded successfully!');

                const splitData = data.split('<>')
                const msgText = splitData[0];
                const logText = splitData[1];
                console.log(data)
                console.log(msgText)
                deleteLoadingDots();
                addToChat("left", msgText, logText);
            },
            error: function (error) {
                console.log('Error uploading image:', error);
            }
        });
    });

    function delete_custom_input() {
        event.preventDefault();
        addToChat("right", "Asking for deleting the custom input...", "");
        insertLoadingDots();
        ttmChat.scrollTop += 200;
        ttmInput.value = "";

        let level = get_level();
        let prompt = get_prompt_type()

        botResponse("quit", '2', level, prompt);
        changeBtnColor(false);
        disableBtn(true);
    }

    function submit_custom_input() {
        const text1 = document.getElementById("first_text").value;
        const text2 = document.getElementById("second_text").value;

        if (text1 !== "" && text2 !== "") {
            event.preventDefault();
            addToChat("right", text1 + "\n" + text2, "");
            insertLoadingDots();
            ttmChat.scrollTop += 200;
            ttmInput.value = "";

            let level = get_level()
            let prompt = get_prompt_type()

            botResponse({"first_input": text1, "second_input": text2}, '1', level, prompt);
            changeBtnColor(true);
            disableBtn(false);
        } else {
            alert("At least one of the input fields are empty!")
        }

        let cih = document.getElementById("custom_input_history");
        const temp_div = document.createElement("div");
        temp_div.style.border = "solid cornflowerblue";
        const temp_div_1 = document.createElement("div");
        const node_1 = document.createTextNode(text1);
        temp_div_1.appendChild(node_1);
        temp_div.appendChild(temp_div_1);

        const temp_div_2 = document.createElement("div");
        const node_2 = document.createTextNode(text2);
        temp_div_2.appendChild(node_2);
        temp_div.appendChild(temp_div_2)
        cih.appendChild(temp_div);
    }

    function change_theme() {

        if (document.getElementById("theme_changing").checked) {
            document.getElementsByClassName("pins-scroll")[0].style.backgroundColor = "white";
            document.getElementsByClassName("ttm-chat")[0].style.backgroundColor = "white";

            for(let i = 0; i < 8; i++){
                document.getElementById("icon" + i).style.color = "";
            }

            document.getElementById("input_1").style.color = "";
            document.getElementById("input_2").style.color = "";
        } else {
            document.getElementsByClassName("pins-scroll")[0].style.backgroundColor = "";
            document.getElementsByClassName("ttm-chat")[0].style.backgroundColor = "";

            for(let i = 0; i < 8; i++){
                document.getElementById("icon" + i).style.color = "white";
            }

            document.getElementById("input_1").style.color = "white";
            document.getElementById("input_2").style.color = "white";
        }
    }

    function disableBtn(flag) {
        if (!flag) {
            document.getElementById("custom_input_btns").style.display = "table-row";
        } else {
            document.getElementById("custom_input_btns").style.display = "none";
        }
    }

    function checkSubmit(e) {
        if (e && e.keyCode === 13) {
            document.getElementById("ttm-send-btn-id").click();
            document.getElementById("textInput").value = "";
        }
    }


    function doSample(rawAction) {
        let username = '{{ currentUserId }}'
        let dataPackage = {action: rawAction, thisUserName: username}
        let jsonDataPackage = JSON.stringify(dataPackage)

        let button_div = document.getElementById("")

        const result = $.ajax({
            type: 'POST',
            url: "{{ url_for('.sample_prompt') }}",
            data: jsonDataPackage,
            processData: false,
            contentType: false,
            cache: false,
            success: function (data) {
                ttmInput.value = data;
            }
        });
    }

    function sampleQACI() {
        doSample("qa_ci");
    }

    function sampleQAcfe() {
        doSample("qa_cfe");
    }

    function sampleQAaug() {
        doSample("qa_da")
    }

    function sampleQAFA() {
        doSample("qa_fa")
    }

    function sampleQARationale() {
        doSample("qa_rat")
    }

    function sampleQASim() {
        doSample("qa_sim")
    }

    function sampleKeyword() {
        doSample("keyword");
    }

    function sampleSentence() {
        doSample("sentence");
    }

    function sampleAdversarial() {
        doSample("adversarial");
    }

    function sampleAugment() {
        doSample("augment");
    }

    function sampleCustomInputRationalization() {
        doSample("c_rationale");
    }

    function sampleCustomInputCounterfactual() {
        doSample("c_cfe");
    }

    function sampleCustomInputDataAugmentation() {
        doSample("c_data");
    }

    function sampleCustomInputPrediction() {
        doSample("custom_input_prediction");
    }

    function sampleCustomInputFeatureAttribution() {
        doSample("custom_input_feature_importance");
    }

    function sampleCustomInputSimilarity() {
        doSample("c_sim");
    }

    function sampleRandomPredict() {
        doSample("random_predict");
    }

    function sampleModel() {
        doSample("model");
    }

    function sampleDataSummary() {
        doSample("data_summary");
    }

    function sampleCountData() {
        doSample("countdata");
    }

    function samplePerformance() {
        doSample("score");
    }

    function sampleMistakeCount() {
        doSample("mistake_count");
    }

    function sampleMistakeSample() {
        doSample("mistake_sample");
    }

    function sampleFlip() {
        doSample("cfe");
    }

    function sampleRationalization() {
        doSample("rationalization");
    }

    function sampleLabels() {
        doSample("labels");
    }

    function sampleSimilar() {
        doSample("similar");
    }

    function sampleWhy() {
        doSample("explain");
    }

    function samplePredict() {
        doSample("predict");
    }

    function sampleShow() {
        doSample("show");
    }

    function sampleAboutFunction() {
        doSample("function");
    }

    function sampleAboutSelf() {
        doSample("self");
    }
</script>

<script>
    document.querySelectorAll('.tooltip-wrapper').forEach((wrapper) => {
        const tooltip = wrapper.querySelector('.tooltip-text');
        wrapper.addEventListener('mouseenter', () => {
            const wrapperRect = wrapper.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();

            if (wrapperRect.left + tooltipRect.width > window.innerWidth) {
                tooltip.style.left = 'auto';
                tooltip.style.right = '0';
            } else {
                tooltip.style.left = '50%';
                tooltip.style.right = 'auto';
            }

            if (wrapperRect.top < tooltipRect.height) {
                tooltip.style.bottom = 'auto';
                tooltip.style.top = '125%';
            } else {
                tooltip.style.bottom = '125%';
                tooltip.style.top = 'auto';
            }
        });
    });
</script>

<script src='https://use.fontawesome.com/releases/v5.0.13/js/all.js'></script>
<script>
    function reset_temp_dataset() {
        let username = '{{ currentUserId }}'
        let dataPackage = {thisUserName: username}
        let jsonDataPackage = JSON.stringify(dataPackage)

        const result = $.ajax({
            type: 'POST',
            url: "{{ url_for('.reset_temp_dataset') }}",
            data: jsonDataPackage,
            processData: false,
            contentType: false,
            cache: false,
        });
    }

</script>
<script>
    function get_prompt_type() {
        if (document.getElementById("p_option1").checked) {
            return "none";
        } else if (document.getElementById("p_option2").checked) {
            return "zero_shot";
        } else if (document.getElementById("p_option3").checked) {
            return "plan_and_solve"
        } else if (document.getElementById("p_option4").checked) {
            return "opro";
        } else {
            return document.getElementById("custom_prompt_input").value;
        }
    }

    function get_level() {
        if (document.getElementById("option1").checked) {
            return "beginner";
        } else if (document.getElementById("option2").checked) {
            return "expertise";
        } else {
            return "expert";
        }
    }

    var counter = 0;

    const ttmForm = get(".ttm-inputarea");
    const ttmInput = get(".ttm-input");
    const ttmChat = get(".ttm-chat");
    const ttmPins = get(".pins-scroll");
    let userInputs = [];
    let userInputIndex = 0;

    // text box command
    ttmForm.addEventListener("submit", event => {
        const msgText = ttmInput.value;

        event.preventDefault();

        if (!msgText) return;
        addToChat("right", msgText, "");
        insertLoadingDots();
        ttmChat.scrollTop += 200;
        ttmInput.value = "";

        let level = get_level();
        let prompt = get_prompt_type();

        botResponse(msgText, '0', level, prompt);
    });

    function changeBtnColor(flag) {
        let ids = ["c_rat", "c_cfe", "c_data", "c_pred", "c_fa", "c_sim"]

        if (flag) {
            ids.forEach(id => {
                document.getElementById(id).style.border = "3px solid rgba(63, 103, 232, 0.96)";
            });
        } else {
            ids.forEach(id => {
                document.getElementById(id).style.border = "";
            });
        }
    }

    function corr_answeredNo(logText) {
        let answer = document.getElementById("msg-text-" + counter).innerText;

        const feedback = `MessageID: ${logText} || Feedback: Correctness Negative || Username: {{ currentUserId }} || Answer: ${answer}`;
        logFeedback(feedback);
    }

    function help_answeredNo(logText) {
        let answer = document.getElementById("msg-text-" + counter).innerText;

        const feedback = `MessageID: ${logText} || Feedback: Helpfulness Negative || Username: {{ currentUserId }} || Answer: ${answer}`;
        logFeedback(feedback);
    }

    function sat_answeredNo(logText) {
        let answer = document.getElementById("msg-text-" + counter).innerText;

        const feedback = `MessageID: ${logText} || Feedback: Satisfaction Negative || Username: {{ currentUserId }} || Answer: ${answer}`;
        logFeedback(feedback);
    }

    function corr_answeredYes(logText) {
        let answer = document.getElementById("msg-text-" + counter).innerText;
        const feedback = `MessageID: ${logText} || Feedback: Correctness Positive || Username: {{ currentUserId }} || Answer: ${answer}`;
        logFeedback(feedback);
    }

    function help_answeredYes(logText) {
        let answer = document.getElementById("msg-text-" + counter).innerText;
        const feedback = `MessageID: ${logText} || Feedback: Helpfulness Positive || Username: {{ currentUserId }} || Answer: ${answer}`;
        logFeedback(feedback);
    }

    function sat_answeredYes(logText) {
        let answer = document.getElementById("msg-text-" + counter).innerText;
        const feedback = `MessageID: ${logText} || Feedback: Satisfaction Positive || Username: {{ currentUserId }} || Answer: ${answer}`;
        logFeedback(feedback);
    }

    function insertLoadingDots() {
        let msgHTML = `
            <div class="loading-dots", id="current-dots">
                <div class="msg left-msg">
                    <div class="msg-bubble">
                        <div class="stage">
                             <div class="dot-pulse"></div>
                        </div>
                    </div>
                </div>
            </div>
          `
        ttmChat.insertAdjacentHTML("beforeend", msgHTML);

        document.getElementById("ttm-send-btn-id").disabled = true;
    }

    function deleteLoadingDots() {
        document.getElementById("current-dots").outerHTML = "";
        document.getElementById("ttm-send-btn-id").disabled = false;
    }

    function pinMessage(text) {
        let msgHTML = `
            <div class="msg left-msg">
              <div class="msg-bubble">
                <div class="msg-text">${text}</div>
              </div>
            </div>
        `;
        ttmPins.insertAdjacentHTML("beforeend", msgHTML);
    }

    function addToChat(side, text, logText) {
        // Defines adding messages to the conversation
        let msgHTML = "";

        // replace quotes for pinned messages, there are some issues with have quotes in here
        let modifiedText = text.replace("\"", "");
        modifiedText = modifiedText.replace("'", "");

        // modifiedText = modifiedText.replace("(", "");
        // modifiedText = modifiedText.replace(")", "");
        if (side == "left") {
            counter++;
            msgHTML = `
            <div class="msg ${side}-msg">
              <div class="msg-bubble">
                <div class="msg-text" id="msg-text-${counter}">${text}</div>
              <div class="happy-sad-unsure-response">
                <div class="all-feedback-${counter}">
                    <div class="feedback-opener-${counter}">
                        Feedback
                    </div>
                    <div class="feedback-form-${counter} container" >
                        <div class="row">
                        <button style="font-size: 12px;">Correctness </button>
                        <button title="positive" class="unhappy-button" id="corr_yesbutton" onclick="corr_answeredYes('${logText}');">üëç</button>
                        <button title="negative" class="unhappy-button" id="corr_nobutton" onclick="corr_answeredNo('${logText}');">üëé</button>
                        </div>

                        <div class="row">
                        <button style="font-size: 12px;">Helpfulness </button>
                        <button title="positive" class="unhappy-button" id="help_yesbutton" onclick="help_answeredYes('${logText}');">üëç</button>
                        <button title="negative" class="unhappy-button" id="help_nobutton" onclick="help_answeredNo('${logText}');">üëé</button>
                        </div>

                        <div class="row">
                        <button style="font-size: 12px;">Satisfaction </button>
                        <button title="positive" class="unhappy-button" id="sat_yesbutton" onclick="sat_answeredYes('${logText}');">üëç</button>
                        <button title="negative" class="unhappy-button" id="sat_nobutton" onclick="sat_answeredNo('${logText}');">üëé</button>
                        </div>
                    </div>
                </div>
              </div>
            </div>
            </div>
            `;

            // <button title="insightful" className="unhappy-button" id="insightbutton"
            //         onClick="answeredInsight('${logText}');">üí°</button>
            // <button title="confused" className="unhappy-button" id="confusedbutton"
            //         onClick="answeredConfused('${logText}');">üòï</button>
            /**
             * <div class="pin-button">
             *                     <svg onclick="pinMessage('${modifiedText}')" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pin-angle-fill" viewBox="0 0 16 16">
             *                       <path d="M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707-.195-.195.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146z"/>
             *                     </svg>
             *                   </div>
             * */

            ttmChat.insertAdjacentHTML("beforeend", msgHTML);
            document.addEventListener("click", doReact);

            function doReact(event) {
                for (var i = 1; i <= counter; i++) {
                    let feedback = document.querySelector("div.feedback-opener-" + i);
                    let isClickInside = feedback.contains(event.target);
                    if (isClickInside) {
                        let right = feedback.getBoundingClientRect().right
                        let bottom = feedback.getBoundingClientRect().bottom
                        let feedbackFrom = document.querySelector("div.feedback-form-" + i);
                        feedbackFrom.style.display = "block";
                        ttmChat.scrollTop += 200;
                    } else {
                        let feedbackFrom = document.querySelector("div.feedback-form-" + i);
                        feedbackFrom.style.display = "none";
                    }
                }
            }
        } else {
            userInputIndex = userInputs.push(text);
            msgHTML = `
              <div class="msg ${side}-msg">
                <div class="msg-bubble">
                  <div class="msg-text">${text}</div>
                </div>
              </div>
              `;
            ttmChat.insertAdjacentHTML("beforeend", msgHTML);
        }
        ttmChat.scrollTop += 500;
    }

    function botResponse(rawText, custom_input, level, prompt) {

        let dataPackage = {
            userInput: rawText,
            userName: "{{ currentUserId }}",
            custom_input: custom_input,
            qalevel: level,
            prompt_type: prompt
        }
        dataPackage = JSON.stringify(dataPackage);
        console.log(dataPackage);

        const result = $.ajax({
            type: 'POST',
            url: "{{ url_for('.get_bot_response') }}",
            data: dataPackage,
            processData: false,
            contentType: false,
            cache: false,
            success: function (data) {
                const splitData = data.split('<>')
                const msgText = splitData[0];
                const logText = splitData[1];
                console.log(data)
                console.log(msgText)
                deleteLoadingDots();
                addToChat("left", msgText, logText);
            }

        });
    }

    function get(selector, root = document) {
        return root.querySelector(selector);
    }
</script>

<script>
    function logFeedback(feedback) {
        result = $.ajax({
            type: 'POST',
            url: "{{ url_for('.log_feedback') }}",
            data: feedback,
            processData: false,
            contentType: false,
            cache: false,
        });
    }


    // Handle key cycling
    document.onkeydown = checkKey;

    function checkKey(e) {
        e = e || window;


        if (e.keyCode == '38') {
            // up arrow
            if (userInputs.length == 0) {
                return
            }
            userInputIndex = userInputIndex - 1;
            if (userInputIndex < 0) {
                userInputIndex = 0;
            }
            ttmInput.value = userInputs[userInputIndex];
        } else if (e.keyCode == '40') {
            // down arrow
            if (userInputs.length == 0) {
                return
            }
            userInputIndex = userInputIndex + 1;
            if (userInputIndex > userInputs.length - 1) {
                userInputIndex = userInputs.length - 1;
            }
            ttmInput.value = userInputs[userInputIndex];
        }
    }
</script>
<script>
    function getAllIndexes(arr, val) {
        let indexes = [], i;
        for (i = 0; i < arr.length; i++)
            if (arr[i].includes(val))
                indexes.push(i);
        return indexes;
    }

    // Filter dataset
    const filterDataForm = get(".filterdata-inputarea");
    const filterDataInput = get(".filterdata-input");
    filterDataForm.addEventListener("keyup", event => {
        event.preventDefault();
        const filterMsgText = filterDataInput.value;
        result = $.ajax({
            type: 'POST',
            url: "{{ url_for('.filter_dataset') }}",
            data: JSON.stringify({
                'filterMsgText': filterMsgText,
            }),
            processData: false,
            contentType: 'application/json',
            cache: false,
            success: function (info) {
                var data = JSON.parse(info["jsonData"]);
                var data_size = Object.keys(data).length;

                var msgHTML = data_size + " out of " + info["totalDataLen"] + " data points:<br>";
                var numDisplayed = 0;
                const span_start = "<span style='background-color: yellow'>";
                const span_end = "</span>";

                for (let [_id, entry] of Object.entries(data)) {
                    msgHTML += "<details style='margin-top: 1px;'"
                    if (numDisplayed == 0) {
                        msgHTML += " open='true';"
                    }
                    msgHTML += "><summary>";
                    msgHTML += "<b>ID:" + _id + "</b></summary>";

                    for (let [field_name, field_content] of Object.entries(entry)) {
                        msgHTML += "<b>" + field_name + ": </b>"
                        msgHTML += "<div style='font-style: italic; font-size: 0.75em;'>";
                        // + field_content
                        if (field_content.includes(filterMsgText) && filterMsgText.length > 0) {
                            let field_content_arr = field_content.split(" ");
                            let idx = getAllIndexes(field_content_arr, filterMsgText);

                            let last_pointer = 0;
                            for (let i = 0; i < idx.length; i++) {
                                if (idx[i] == 0) {
                                    msgHTML += span_start;
                                    msgHTML += field_content_arr[idx[i]];
                                    msgHTML += span_end;
                                    msgHTML += " ";
                                    last_pointer = 1;
                                } else if (idx.length > 1 && idx[i] == field_content_arr.length - 1) {
                                    msgHTML += span_start;
                                    msgHTML += field_content_arr[idx[i]];
                                    msgHTML += span_end;
                                    msgHTML += " ";
                                    last_pointer = 1;
                                } else if (idx.length == 1 && idx[i] == field_content_arr.length - 1) {
                                    for (let i = 0; i < idx[0]; i++) {
                                        msgHTML += field_content_arr[i];
                                        msgHTML += " ";
                                    }

                                    msgHTML += span_start;
                                    msgHTML += field_content_arr[idx[i]];
                                    msgHTML += span_end;
                                    msgHTML += " ";
                                    last_pointer = idx[i];
                                } else {

                                    for (let j = last_pointer; j < idx[i]; j++) {
                                        msgHTML += field_content_arr[j];
                                        msgHTML += " ";
                                    }

                                    msgHTML += span_start;
                                    msgHTML += field_content_arr[idx[i]];
                                    msgHTML += span_end;
                                    msgHTML += " ";
                                    last_pointer = idx[i] + 1;
                                }
                            }

                            if (idx[idx.length - 1] < field_content_arr.length) {
                                for (let i = idx[idx.length - 1] + 1; i < field_content_arr.length; i++) {
                                    msgHTML += field_content_arr[i];
                                    msgHTML += " ";
                                }
                            }
                        } else {
                            msgHTML += field_content;
                        }
                        msgHTML += "</div>";
                    }
                    msgHTML += "<button style=\"margin: 1px; padding: 1px\" type=\"button\" class=\"btn btn-outline-secondary\" onclick=\"addId("
                    msgHTML += _id
                    msgHTML += ")\">Add this instance into input box</button>"
                    msgHTML += "</details>"


                    numDisplayed += 1;
                    if (numDisplayed >= 10) {
                        msgHTML += "<br>(Showing first 10)";
                        break
                    }
                }
                document.getElementById("show_data").innerHTML = msgHTML;
            }
        })
    });

    function addId(_id) {
        let string = "For id ";
        string += _id;
        string += ", "
        document.getElementById("textInput").value = string;
    }
</script>
